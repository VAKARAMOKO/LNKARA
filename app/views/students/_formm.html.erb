<% classroom = student.classroom %>
<% promo = classroom.promo %>

<% if student.persisted? %>
  <div class="p-4" id="checklist-<%= checklist.id %>">

    <!-- Msg Title checklist /!-->
    <div class="text-content mb-2 p-2">
      <% if student.title.present? %>
        <h5 class='m-0'><%= checklist.title %></h5>
      <% else %>
        <h5 class='m-0 text-muted'>Click to add title</h5>
      <% end %>
    </div>

    <!-- checklist form/!-->

    <div class="form-content d-none mb-2">
      <%= form_with(model: [promo, classroom, student]) do |form| %>
        <label>Checklist title</label>
        <%= form.text_field :title, class: 'form-control' %>
        <div class="buttons mt-3">
          <%= form.submit "Ajoute checklist", class: 'btn btn-primary' %>
          <a href="#" class='cancel btn btn-light'>Cancel</a>
        </div>
      <% end %>
    </div>

    <!-- checklist_item fomr/!-->

    <div class="checklist-item-form">
      <%= form_with(model: [promo, classroom, student, checklist.new_item]) do |form| %>
        <div class="input-group">
          <%= form.text_field :title, class: 'form-control', placeholder: "Add a new checklist item" %>
          <div class="input-group-append">
            <%= form.submit "Save Item", class: 'btn btn-dark' %>
          </div>
        </div>
      <% end %>
    </div>


    <div class="checklist-items mt-3">
      <!-- progress bar section/!-->
      <div class="progress mb-3">
        <% percent_complete = student.percent_complete %>
        <% percent_in_progress = student.percent_in_progress %>

        <!-- progress bar 100%/!-->
        <div class="progress-bar bg-dark" role="progressbar" style="width: <%= percent_complete %>%" aria-valuenow="<%= percent_complete %>" aria-valuemin="0" aria-valuemax="100"></div>

        <!-- progress bar not 100%/!-->
        <div class="progress-bar bg-primary" role="progressbar" style="width: <%= percent_in_progress %>%" aria-valuenow="<%= percent_in_progress %>" aria-valuemin="0" aria-valuemax="100"></div>
      </div>

      <!--list checklist_item/!-->
      <ul class='list-group'>

        <!-- loop to print checklist_item/!-->
        <% student.checklist_items.each do |checklist_item| %>
          <% if checklist_item.persisted? %>
            <li class='list-group-item d-flex justify-content-between'>
              <span><%= checklist_item.title %></span>
              <div>
                <div class="dropdown float-left mr-4">
                  <!-- Options/!-->
                  <button class="btn btn-sm mr-1 btn-outline-<%= checklist_item.color_class %> dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <%= checklist_item.readable_status %>
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <% ChecklistItem::STATUS_OPTIONS.each do |status| %>
                      <a class="dropdown-item" href="#"
                      data-reflex="click->ChecklistItemReflex#change_status"
                      data-id="<%= checklist_item.id %>"
                      data-status="<%= status[1] %>">
                        <%= status[0] %>
                      </a>
                    <% end %>
                  </div>
                </div>

                <!-- delete option/!-->
                <%= link_to promo_classroom_student_checklist_item_path(promo, classroom, student, checklist_item), method: :delete, data: { confirm: "Are you sure?" } do %>
                  <i class='fas fa-times text-secondary'></i>
                <% end %>
              </div>
            </li>
          <% end %>
        <% end %>
      </ul>
    </div>

  </div>
<% end %>




 <!-- checklist_item form/!-->

    <div class="checklist-item-form">
      <%= form_with(model: [promo, classroom, student, checklist.new_item]) do |form| %>
        <div class="input-group">
          <%= form.text_field :title, class: 'form-control', placeholder: "Add a new checklist item" %>
          <div class="input-group-append">
            <%= form.submit "Save Item", class: 'btn btn-dark' %>
          </div>
        </div>
      <% end %>
    </div>


    <div class="checklist-items mt-3">
      <!-- progress bar section/!-->
      <div class="progress mb-3">
        <% percent_complete = student.percent_complete %>
        <% percent_in_progress = student.percent_in_progress %>

        <!-- progress bar 100%/!-->
        <div class="progress-bar bg-dark" role="progressbar" style="width: <%= percent_complete %>%" aria-valuenow="<%= percent_complete %>" aria-valuemin="0" aria-valuemax="100"></div>

        <!-- progress bar not 100%/!-->
        <div class="progress-bar bg-primary" role="progressbar" style="width: <%= percent_in_progress %>%" aria-valuenow="<%= percent_in_progress %>" aria-valuemin="0" aria-valuemax="100"></div>
      </div>

      <!--list checklist_item/!-->
      <ul class='list-group'>

        <!-- loop to print checklist_item/!-->
        <% student.checklist_items.each do |checklist_item| %>
          <% if checklist_item.persisted? %>
            <li class='list-group-item d-flex justify-content-between'>
              <span><%= checklist_item.title %></span>
              <div>
                <div class="dropdown float-left mr-4">
                  <!-- Options/!-->
                  <button class="btn btn-sm mr-1 btn-outline-<%= checklist_item.color_class %> dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <%= checklist_item.readable_status %>
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <% ChecklistItem::STATUS_OPTIONS.each do |status| %>
                      <a class="dropdown-item" href="#"
                      data-reflex="click->ChecklistItemReflex#change_status"
                      data-id="<%= checklist_item.id %>"
                      data-status="<%= status[1] %>">
                        <%= status[0] %>
                      </a>
                    <% end %>
                  </div>
                </div>

                <!-- delete option/!-->
                <%= link_to promo_classroom_student_checklist_item_path(promo, classroom, student, checklist_item), method: :delete, data: { confirm: "Are you sure?" } do %>
                  <i class='fas fa-times text-secondary'></i>
                <% end %>
              </div>
            </li>
          <% end %>
        <% end %>
      </ul>
    </div>

  </div>
